/*
 * @author: Laure Buysse
 * @file: lcdControl.c
 */

//files to include
#include "lcdControl.h"
#include "lcdDriver.h"

#include <stdio.h>
#include "MK64F12.h"
#include <stdlib.h>

const unsigned char font [96][6] = {
		{0x00,0x00,0x00,0xFF,0x00,0xFF}, //
		{0x2f,0x00,0xFF,0x00,0xFF,0x00}, // !
		{0x03,0x00,0x03,0x00,0xFF,0x00}, // "
		{0x12,0x3f,0x12,0x12,0x3f,0x12}, // #
		{0x2e,0x2a,0x7f,0x2a,0x3a,0x00}, // $
		{0x23,0x13,0x08,0x04,0x32,0x31}, // %
		{0x10,0x2a,0x25,0x2a,0x10,0x20}, // &
		{0x02,0x01,0x00,0xFF,0x00,0xFF}, // '
		{0x1e,0x21,0x00,0xFF,0x00,0xFF}, // (
		{0x21,0x1e,0x00,0xFF,0x00,0xFF}, // )
		{0x08,0x2a,0x1c,0x2a,0x08,0x00}, // *
		{0x08,0x08,0x3e,0x08,0x08,0x00}, // +
		{0x80,0x60,0x00,0xFF,0x00,0xFF}, // ,
		{0x08,0x08,0x08,0x08,0x08,0x00}, // -
		{0x30,0x30,0x00,0xFF,0x00,0xFF}, // .
		{0x20,0x10,0x08,0x04,0x02,0x00}, // /
		{0x1e,0x31,0x29,0x25,0x23,0x1e}, // 0
		{0x22,0x21,0x3f,0x20,0x20,0x00}, // 1
		{0x32,0x29,0x29,0x29,0x29,0x26}, // 2
		{0x12,0x21,0x21,0x25,0x25,0x1a}, // 3
		{0x18,0x14,0x12,0x3f,0x10,0x10}, // 4
		{0x17,0x25,0x25,0x25,0x25,0x19}, // 5
		{0x1e,0x25,0x25,0x25,0x25,0x18}, // 6
		{0x01,0x01,0x31,0x09,0x05,0x03}, // 7
		{0x1a,0x25,0x25,0x25,0x25,0x1a}, // 8
		{0x06,0x29,0x29,0x29,0x29,0x1e}, // 9
		{0x24,0x00,0xFF,0x00,0xFF,0x00}, // :
		{0x80,0x64,0x00,0xFF,0x00,0xFF}, // ;
		{0x08,0x14,0x22,0x00,0xFF,0x00}, // <
		{0x14,0x14,0x14,0x14,0x14,0x00}, // =
		{0x22,0x14,0x08,0x00,0xFF,0x00}, // >
		{0x02,0x01,0x01,0x29,0x05,0x02}, // ?
		{0x1e,0x21,0x2d,0x2b,0x2d,0x0e}, // @
		{0x3e,0x09,0x09,0x09,0x09,0x3e}, // A
		{0x3f,0x25,0x25,0x25,0x25,0x1a}, // B
		{0x1e,0x21,0x21,0x21,0x21,0x12}, // C
		{0x3f,0x21,0x21,0x21,0x12,0x0c}, // D
		{0x3f,0x25,0x25,0x25,0x25,0x21}, // E
		{0x3f,0x05,0x05,0x05,0x05,0x01}, // F
		{0x1e,0x21,0x21,0x29,0x29,0x1a}, // G
		{0x3f,0x04,0x04,0x04,0x3f,0x00}, // H
		{0x21,0x21,0x3f,0x21,0x21,0x00}, // I
		{0x10,0x20,0x20,0x20,0x20,0x1f}, // J
		{0x3f,0x04,0x04,0x0a,0x11,0x20}, // K
		{0x3f,0x20,0x20,0x20,0x20,0x20}, // L
		{0x3f,0x02,0x04,0x04,0x02,0x3f}, // M
		{0x3f,0x02,0x04,0x08,0x10,0x3f}, // N
		{0x1e,0x21,0x21,0x21,0x21,0x1e}, // O
		{0x3f,0x09,0x09,0x09,0x09,0x06}, // P
		{0x1e,0x21,0x29,0x31,0x21,0x1e}, // Q
		{0x3f,0x09,0x09,0x09,0x19,0x26}, // R
		{0x12,0x25,0x25,0x25,0x25,0x18}, // S
		{0x01,0x01,0x01,0x3f,0x01,0x01}, // T
		{0x1f,0x20,0x20,0x20,0x20,0x1f}, // U
		{0x0f,0x10,0x20,0x20,0x10,0x0f}, // V
		{0x1f,0x20,0x10,0x10,0x20,0x1f}, // W
		{0x21,0x12,0x0c,0x0c,0x12,0x21}, // X
		{0x01,0x02,0x04,0x38,0x04,0x02}, // Y
		{0x21,0x31,0x29,0x25,0x23,0x21}, // Z
		{0x3f,0x21,0x00,0xFF,0x00,0xFF}, // [
		{0x02,0x04,0x08,0x10,0x20,0x00}, // "\"
		{0x21,0x3f,0x00,0xFF,0x00,0xFF}, // ]
		{0x04,0x02,0x3f,0x02,0x04,0x00}, // ^
		{0x40,0x40,0x40,0x40,0x40,0x40}, // _
		{0x01,0x02,0x00,0xFF,0x00,0xFF}, // `
		{0x10,0x2a,0x2a,0x2a,0x3c,0x00}, // a
		{0x3f,0x24,0x24,0x24,0x18,0x00}, // b
		{0x1c,0x22,0x22,0x22,0x00,0xFF}, // c
		{0x18,0x24,0x24,0x24,0x3f,0x00}, // d
		{0x1c,0x2a,0x2a,0x2a,0x24,0x00}, // e
		{0x3e,0x05,0x01,0x00,0xFF,0x00}, // f
		{0x18,0xa4,0xa4,0xa4,0x7c,0x00}, // g
		{0x3f,0x04,0x04,0x04,0x38,0x00}, // h
		{0x24,0x3d,0x20,0x00,0xFF,0x00}, // i
		{0x20,0x40,0x40,0x3d,0x00,0xFF}, // j
		{0x3f,0x0c,0x12,0x20,0x00,0xFF}, // k
		{0x1f,0x20,0x20,0x00,0xFF,0x00}, // l
		{0x3e,0x02,0x3c,0x02,0x3c,0x00}, // m
		{0x3e,0x02,0x02,0x02,0x3c,0x00}, // n
		{0x1c,0x22,0x22,0x22,0x1c,0x00}, // o
		{0xfc,0x24,0x24,0x24,0x18,0x00}, // p
		{0x18,0x24,0x24,0x24,0xfc,0x00}, // q
		{0x3c,0x02,0x02,0x02,0x00,0xFF}, // r
		{0x24,0x2a,0x2a,0x2a,0x10,0x00}, // s
		{0x02,0x1f,0x22,0x20,0x00,0xFF}, // t
		{0x1e,0x20,0x20,0x20,0x1e,0x00}, // u
		{0x06,0x18,0x20,0x18,0x06,0x00}, // v
		{0x1e,0x20,0x1c,0x20,0x1e,0x00}, // w
		{0x22,0x14,0x08,0x14,0x22,0x00}, // x
		{0x1c,0xa0,0xa0,0xa0,0x7c,0x00}, // y
		{0x22,0x32,0x2a,0x26,0x22,0x00}, // z
		{0x0c,0x3f,0x21,0x00,0xFF,0x00}, // {
		{0x3f,0x00,0xFF,0x00,0xFF,0x00}, // |
		{0x21,0x3f,0x0c,0x00,0xFF,0x00}, // }
		{0x02,0x01,0x02,0x01,0x00,0xFF}, // ~
		{0x00,0x00,0x00,0x00,0xFF,0xFF}
};

void put_character(unsigned char character){
	// Get the current position
	uint8_t xpos = get_xpos();
	uint8_t ypos = get_ypos();

	// The font supports ASCI characters from 32 to 127
	if((character >  31)||(character < 128)){
		if(xpos + 6 > 127){						// check to see if there is enough space on current page
			set_pos(0, (ypos+8) & 0x1F);		// go to start of next line (not enough space on current line
		}
		// Character position in area based on ASCI (without the first 32 characters, substract this offset
		character = character - 32;

		// Write character to display (write one row in the fonts to display = sizeof(font[c])
		for(int i = 0; i < sizeof(font[character]); i++){
			if (font[character][i] == 0xFF){
				// Shorten character standard with (6) if the array contains 0xFF
				break;
			}
			else {
				lcd_data(font[character][i]);			// Write data to display
				xpos++;							// Go to next x-position
			}

		}
	}
	else{
		// character not in the library
		return;
	}
}

void put_string(char* str){
	while(*str){
		put_character(*(str++));
	}
}

void put_string_pos(char* str, uint8_t x, uint8_t y){
	set_pos(x,y);
	put_string(str);
}

void put_int(int integer,uint8_t x,uint8_t y){
	set_pos(x,y);					//set position on the screen
	char str[20];
	sprintf(str, "%d", integer);	//convert integer to string
	put_string(str);			//print string
}

void display_time_lefttop(int hours, int minutes, int seconds){
	clear_line(0);
	if(hours < 10 ){
		put_int(0,0,0);
		put_int(hours,8,0);
	}
	else {
		put_int(hours,0,0);
	}

	put_string(" : ");

	if(minutes < 10){
		put_int(0,18,0);
		put_int(minutes,26,0);
	}
	else {
		put_int(minutes,18,0);
	}

	put_string(" : ");

	if(seconds < 10){
		put_int(0,38,0);
		put_int(seconds,46,0);
	}
	else {
		put_int(seconds,38,0);
	}
}

void display_time_center(int hours, int minutes, int seconds){
	clear_line(2);
	if(hours < 10 ){
		put_int(0,40,16);
		put_int(hours,48,16);
	}
	else {
		put_int(hours,40,16);
	}

	put_string(" : ");

	if(minutes < 10){
		put_int(0,58,16);
		put_int(minutes,66,16);
	}
	else {
		put_int(minutes,58,16);
	}

	put_string(" : ");

	if(seconds < 10){
		put_int(0,78,16);
		put_int(seconds,84,16);
	}
	else {
		put_int(seconds,78,16);
	}
}

void display_time_current(int hours, int minutes, int seconds){
	clear_lcd();
	put_string_pos("Current time: ",0,0);
	display_time_center(hours, minutes, seconds);
}

void display_time_alarm(int hours, int minutes, int seconds){
	clear_lcd();
	put_string_pos("Alarm time set for: ",0,0);
	display_time_center(hours, minutes, seconds);
}

void display_time_time(int hours, int minutes,int seconds){
	clear_lcd();
	put_string_pos("new time set for: ",0,0);
	display_time_center(hours, minutes, seconds);
}

void center_text(char* str, int lengthstr){
	clear_line(2);
	int ypos = 16;

	/* Calculate the (start) x-position based on the length of the string */
	int xpos = 64 - ((lengthstr*6)/2);

	/* Write string to lcd */
	put_string_pos(str, xpos, ypos);
}

void display_music(char* str, int lengthstr){
	clear_lcd();
	put_string_pos("Current alarm tone: ",0,0);
	center_text(str, lengthstr);
}

void display_menu(char* str, int length, int hours, int minutes, int seconds){
	clear_lcd();
	/* Display current time in the left top corner */
	display_time_lefttop(hours, minutes, seconds);

	/* Display the current menu item in the middle */
	center_text(str, length);
}

void display_alarm_onOff(int onOff){
	if(onOff==0){
		put_string_pos("Off",110,1);
	}else{
		put_string_pos("On ",110,1);
	}
}

void clear(void){
	clear_lcd();
}
